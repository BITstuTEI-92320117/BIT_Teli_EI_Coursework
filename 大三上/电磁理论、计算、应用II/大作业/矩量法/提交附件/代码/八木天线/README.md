# 八木天线矩量法仿真代码
## 一、代码概述
本代码基于**矩量法（MoM）** 实现八木天线（含反射器、有源振子、引向器）的辐射特性分析与参数优化，可计算天线电流分布、输入阻抗、方向性系数、E/H面半功率波瓣宽度，绘制二维/三维辐射方向图，并支持单参数变量分析（如反射器长度、引向器个数对方向性的影响）。

## 二、环境依赖
- 运行环境：MATLAB（无需额外工具箱）
- 核心参数：默认频率300MHz，天线半径0.001m，匹配点个数101，可在主程序中修改

## 三、函数功能说明
| 函数名                                  | 核心功能                                                                 |
|-----------------------------------------|--------------------------------------------------------------------------|
| `Direction_map_2D_HPBW(D, lr, ls, ld, ld_num, dr, ds, flag)` | 绘制E面/H面二维方向图，调用`HPBW`函数计算半功率波瓣宽度，支持结果保存       |
| `Direction_map_3D(D, lr, ls, ld, ld_num, dr, ds, flag)`      | 绘制三维辐射方向图（默认视角60°），对方向性数据归一化处理                   |
| `DN(A)`                                  | 数据归一化（最大值-最小值缩放），用于方向图绘制和数据对比                   |
| `funcD(E, Z0)`                           | 基于坡印亭矢量和数值积分计算方向性系数，输出全局最大值                     |
| `funcE(r, z, I, a, dl_all, k, Z0, N, num, M, d)` | 计算远场总电场（累加各天线辐射场），含坐标变换处理多天线间距影响             |
| `HPBW(D, theta)`                         | 通过线性插值定位半功率点，计算波瓣宽度（处理主瓣跨0°/360°情况）             |
| `MoM_I(Z, b, z, N, num, flag, l)`        | 求解矩量法矩阵方程，重构各天线电流分布，可选绘制单天线电流图和汇总图         |
| `MoM_Zb(a, k, Z0, N, dl_all, z, num, d)` | 构建核心Z矩阵（含天线自耦合、互耦合）和b向量（仅有源振子非零），处理奇异点   |
| `MoM_Zin(I, N)`                          | 根据有源振子馈电点电流计算输入阻抗                                         |

## 四、运行方式
### 1. 核心主程序选择
代码包含两个核心主程序，按需运行：
- **基础仿真主程序**（默认执行）：固定参数仿真，输出天线辐射特性（电流、阻抗、方向图）；
- **参数分析主程序**：通过`flag`变量控制，分析单一参数对方向性系数的影响（如反射器长度、引向器个数等）。

### 2. 参数配置
#### （1）基础仿真主程序
修改核心参数（默认值如下）：
- `lr/ls/ld`：反射器/有源振子/引向器半长（默认0.3/0.25/0.225m）；
- `ld_num`：引向器个数（默认3个，最优4个）；
- `dr/ds`：反射器-有源振子间距/引向器间距（默认0.25m，最优0.324m）；
- `flag1`：方向图绘制开关（1=启用，0=关闭）。

#### （2）参数分析主程序
设置`flag`值切换分析模式：
| flag值 | 分析模式                     | 参数遍历范围                  |
|--------|------------------------------|-------------------------------|
| 1      | 反射器长度影响               | 0.01~1m（步长0.01m）           |
| 2      | 有源振子长度影响             | 0.01~1m（步长0.01m）           |
| 3      | 引向器长度影响               | 0.005~1m（步长0.005m）         |
| 4      | 引向器个数影响               | 1~10个                        |
| 5      | 反射器-有源振子间距影响       | 0.01~1m（步长0.01m）           |
| 6      | 引向器间距影响               | 0.01~1m（步长0.01m）           |
| 7      | 统一天线间距影响             | 0.01~1m（步长0.01m）           |
| 其他   | 匹配点个数影响               | 11~1001（步长10）              |

### 3. 执行步骤
1. 将所有函数文件与主程序放在同一目录；
2. 打开MATLAB，切换至该目录；
3. 选择主程序运行：
   - 基础仿真：直接运行基础主程序，输出实时数据和图表；
   - 参数分析：修改`flag`值后运行参数分析主程序，输出变化曲线和Excel数据；
4. 结果查看：
   - 实时输出：输入阻抗、方向性系数、E/H面半功率波瓣宽度；
   - 图表文件：自动保存电流分布、方向图、参数变化曲线（.png/.fig格式）；
   - 数据文件：参数分析结果保存为Excel（如方向性系数随反射器长度变化值.xlsx）。

## 五、关键说明
1. 耦合处理：`MoM_Zb`函数同时计算天线自耦合（处理奇异点）和互耦合（考虑天线间距）；
2. 最优参数：默认参数为对照组，最优配置为`lr=0.239m、ls=0.190m、ld=0.226m、ld_num=4、dr=ds=0.324m`（方向性系数18.9354）；
3. 数值稳定性：匹配点个数建议≤700，过大易导致输入阻抗震荡；
4. 输出路径：所有结果文件默认保存于当前工作目录，无需手动创建文件夹。
